<?xml version="1.0" encoding="utf-8"?>
<project name="web" default=".help">
    <!--
    The build-impl.xml file imported here contains the guts of the build process. It is
    a great idea to read that file to understand how the process works, but it is best to
    limit your changes to this file.
    -->
    <import file="${basedir}/.sencha/app/build-impl.xml"/>

    <target name="-after-build">
        <!-- Copies api mock files to output dir -->
        <copy todir="${build.dir}/api-mock" overwrite="true">
            <fileset dir="${app.dir}/api-mock"/>
        </copy>

        <!-- Copies index file, config and loader to output dir -->
        <copydir src="${app.dir}/loader" dest="${build.dir}/loader"/>
        <copydir src="${app.dir}/libs" dest="${build.dir}/libs"/>
        <echo file="${build.dir}/loader/version"><![CDATA[${app.config.build}]]></echo>
        <echo file="${build.dir}/loader/config.js"><![CDATA[
/*
 * This file is generated by build script and should NOT be edited.
 * See build.xml for more details.
 */
var criterion = criterion || {},
    _urls;

criterion.locales = [];
criterion.PRODUCTION = true;
criterion.BUILD = "${app.config.build}";
criterion.AUTH_URL = "";
criterion.AUTH_URLS = '${app.config.api.auth}';
criterion.appName = 'admin';
criterion.support = {};
criterion.support.phone = '+1 203 703 9000';
criterion.support.email = 'support@criterionhcm.com';
criterion.setAuthUrl = function() {
        try {
            var paramType = typeof criterion.AUTH_URLS;

            if (paramType === "string") {
                _urls = JSON.parse(criterion.AUTH_URLS);
            } else if (paramType === "object") {
                _urls = criterion.AUTH_URLS;
            }

            criterion.AUTH_URL = _urls[document.location.hostname] || _urls['default'];
            delete _urls;
        } catch (e) {
            criterion.AUTH_URL = criterion.AUTH_URLS;
        }
    };

criterion.setAuthUrl();

]]></echo>

        <x-compress-js srcfile="${build.dir}/loader/loader.js" id="loader"/>
        <x-compress-css srcfile="${build.dir}/loader/loader.css"/>
    </target>
</project>
